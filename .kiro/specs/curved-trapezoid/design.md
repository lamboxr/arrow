# 弯曲梯形设计文档

## 概述

此设计在现有的TrapezoidWidget基础上扩展，实现梯形向左弯曲的效果。通过修改几何计算和绘制方法，使用贝塞尔曲线来创建平滑的弯曲腰线，同时保持原有的渐变效果。

## 架构

### 核心修改
- **几何计算**: 修改`_create_trapezoid_polygon`方法，实现上底左移200像素
- **曲线绘制**: 新增`_create_curved_path`方法，使用QPainterPath绘制贝塞尔曲线
- **渐变适配**: 修改渐变计算以适应弯曲路径

### 技术实现
- **QPainterPath**: 用于创建贝塞尔曲线路径
- **二次贝塞尔曲线**: 实现平滑的向右凸起效果
- **路径渐变**: 沿曲线路径应用渐变效果

## 组件和接口

### 弯曲几何计算

```python
def _create_curved_trapezoid_geometry(self):
    # 计算弯曲后的顶点位置
    # 下底保持不变
    # 上底向左移动200像素
    
def _create_curved_path(self, start_point, end_point):
    # 创建贝塞尔曲线路径
    # 计算控制点实现向右凸起
```

### 弯曲参数

```python
CURVE_PARAMETERS = {
    'left_offset': 200,        # 上底左移距离
    'curve_intensity': 0.3,    # 弯曲强度系数
    'control_point_ratio': 0.5 # 控制点位置比例
}
```

## 数学模型

### 弯曲计算
- 上底中心点向左移动200像素
- 使用二次贝塞尔曲线连接上下底端点
- 控制点位置：在直线中点的右侧，距离为弯曲强度 × 梯形高度

### 控制点计算公式
```
控制点X = 直线中点X + 弯曲强度 × 梯形高度 × 0.3
控制点Y = 直线中点Y

示例计算（弯曲强度0.3，梯形高度300px）：
控制点X偏移 = 0.3 × 300 × 0.3 = 27像素（向右）
```

## 渐变适配

### 曲线渐变
- 使用QPainterPathStroker创建可描边的路径
- 沿路径长度计算渐变位置
- 保持原有的三点渐变色彩

## 错误处理

### 几何验证
- 验证弯曲后的形状仍在Widget范围内
- 检查控制点计算的有效性
- 处理极端弯曲参数的情况

## 测试策略

### 几何测试
- 验证上底左移200像素的准确性
- 测试下底位置保持不变
- 检查弯曲路径的平滑性

### 视觉测试
- 验证向右凸起的弯曲效果
- 检查渐变在曲线上的正确应用
- 确认整体视觉效果的自然性